<Window x:Class="SqlToExcel.Views.ValidationResultView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SqlToExcel.Views"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        mc:Ignorable="d"
        Title="行验证结果" Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="{Binding Summary}" FontWeight="Bold" Margin="5" TextWrapping="Wrap"/>

        <!-- Replaced DataGrid with ItemsControl -->
        <!-- Main content area -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" CanContentScroll="True">
            <ItemsControl ItemsSource="{Binding PaginatedRowResults}" Margin="5">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5,0,5" Padding="5">
                            <StackPanel>
                                <!-- Display GroupName and MismatchedColumnsSummary -->
                                <TextBlock FontWeight="Bold" FontSize="14" Margin="0,0,0,5">
                                    <Run Text="{Binding GroupName, Mode=OneWay}"/>
                                    <Run Text=" - "/>
                                    <Run Text="{Binding MismatchedColumnsSummary, Mode=OneWay}"/>
                                </TextBlock>

                                <!-- Inner DataGrid for Mismatches -->
                                <DataGrid ItemsSource="{Binding Mismatches}" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False" HeadersVisibility="Column"
                                          GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="LightGray" VerticalGridLinesBrush="LightGray"
                                          ScrollViewer.VerticalScrollBarVisibility="Disabled">
                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsMatch}" Value="False">
                                                    <Setter Property="Background" Value="#FFCDD2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="字段名" Binding="{Binding DisplayColumnName}" Width="*"/>
                                        <DataGridTextColumn Header="源数据" Binding="{Binding SourceValue}" Width="*"/>
                                        <DataGridTextColumn Header="目标数据" Binding="{Binding TargetValue}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
            <Button Content="导出到Excel" Command="{Binding ExportToExcelCommand}" Margin="0,0,10,0"/>
            <Button Content="上一页" Command="{Binding PreviousPageCommand}" Margin="0,0,10,0"/>
            <TextBlock Text="{Binding PageInfo}" VerticalAlignment="Center"/>
            <Button Content="下一页" Command="{Binding NextPageCommand}" Margin="10,0,0,0"/>
        </StackPanel>
    </Grid>
</Window>
