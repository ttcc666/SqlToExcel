<hc:BlurWindow x:Class="SqlToExcel.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SqlToExcel"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:views="clr-namespace:SqlToExcel.Views"
        mc:Ignorable="d"
        Title="SQL to Excel Exporter" Height="900" Width="1200"
        Icon="/Icon/icon.ico"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="_文件">
                <MenuItem Header="_数据库配置" Command="{Binding OpenConfigCommand}" />
                <Separator />
                <MenuItem Header="_切换主题" Command="{Binding SwitchThemeCommand}" />
                <Separator />
                <MenuItem Header="_退出" Command="{Binding ExitCommand}" />
            </MenuItem>
            <MenuItem Header="_工具">
                <MenuItem Header="_字段类型提取" Click="OpenFieldTypeExtractor_Click" />
                <MenuItem Header="_字段对比" Click="OpenFieldComparison_Click" />
                <Separator />
                <MenuItem Header="_Target表信息比对" Command="{Binding ShowTableComparisonCommand}" />
            </MenuItem>
        </Menu>

        <TabControl Grid.Row="1">
            <TabItem Header="手动导出">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0" IsEnabled="{Binding IsCoreFunctionalityEnabled}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="20" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Source Query -->
                        <hc:Card Header="查询 1 (源数据库)" Grid.Column="0" Margin="0,0,10,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal" Margin="5">
                                    <TextBlock Text="选择表:" VerticalAlignment="Center" />
                                    <hc:ComboBox ItemsSource="{Binding Tables1View}" SelectedItem="{Binding SelectedTable1}" Text="{Binding SearchText1, UpdateSourceTrigger=PropertyChanged}" DisplayMemberPath="Name" Width="200" Margin="5,0" IsEditable="True" IsTextSearchEnabled="True" />
                                    <Button Content="选择列" Command="{Binding OpenColumnSelectorCommand1}" Margin="5" hc:IconElement.Geometry="{StaticResource App.PlaylistEdit}" />
                                    <Button Content="排序" Command="{Binding OpenSortDialogCommand1}" Margin="5" hc:IconElement.Geometry="{StaticResource App.Sort}" />
                                    <Button Content="从JSON导入" Command="{Binding ImportJsonCommand}" Margin="5" hc:IconElement.Geometry="{StaticResource App.Json}"/>
                                </StackPanel>

                                <hc:Divider Grid.Row="1" Margin="5" />

                                <hc:TextBox Grid.Row="2" Text="{Binding SqlQuery1, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="5"
                                         FontFamily="Consolas" VerticalContentAlignment="Top" />
                                <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="5">
                                    <TextBlock Text="Sheet 名称:" VerticalAlignment="Center" />
                                    <hc:TextBox Text="{Binding SheetName1, UpdateSourceTrigger=PropertyChanged}" Width="200" Margin="5,0" />
                                    <Button Content="预览" Command="{Binding Preview1Command}" Style="{StaticResource ButtonPrimary}" hc:IconElement.Geometry="{StaticResource App.Eye}" />
                                </StackPanel>
                            </Grid>
                        </hc:Card>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch" />

                        <!-- Target Query -->
                        <hc:Card Header="查询 2 (目标数据库)" Grid.Column="2" Margin="10,0,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <TextBlock Text="目标类型:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <RadioButton GroupName="Destination" Content="目标数据库" VerticalAlignment="Center" Margin="0,0,10,0" Command="{Binding SelectTargetDestinationCommand}">
                                        <RadioButton.Style>
                                            <Style TargetType="RadioButton" BasedOn="{StaticResource RadioButtonBaseStyle}">
                                                <Setter Property="IsChecked" Value="False" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedDestination}" Value="Target">
                                                        <Setter Property="IsChecked" Value="True" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </RadioButton.Style>
                                    </RadioButton>
                                    <RadioButton GroupName="Destination" Content="框架库" VerticalAlignment="Center" Command="{Binding SelectFrameworkDestinationCommand}">
                                        <RadioButton.Style>
                                            <Style TargetType="RadioButton" BasedOn="{StaticResource RadioButtonBaseStyle}">
                                                <Setter Property="IsChecked" Value="False" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedDestination}" Value="Framework">
                                                        <Setter Property="IsChecked" Value="True" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </RadioButton.Style>
                                    </RadioButton>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5">
                                    <TextBlock Text="选择表:" VerticalAlignment="Center" />
                                    <hc:ComboBox ItemsSource="{Binding Tables2View}" SelectedItem="{Binding SelectedTable2}" Text="{Binding SearchText2, UpdateSourceTrigger=PropertyChanged}" DisplayMemberPath="Name" Width="200" Margin="5,0" IsEditable="True" IsTextSearchEnabled="True" />
                                    <Button Content="选择列" Command="{Binding OpenColumnSelectorCommand2}" Margin="5" hc:IconElement.Geometry="{StaticResource App.PlaylistEdit}" />
                                    <Button Content="排序" Command="{Binding OpenSortDialogCommand2}" Margin="5" hc:IconElement.Geometry="{StaticResource App.Sort}" />
                                </StackPanel>

                                <hc:Divider Grid.Row="2" Margin="5" />

                                <hc:TextBox Grid.Row="3" Text="{Binding SqlQuery2, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="5"
                                         FontFamily="Consolas" VerticalContentAlignment="Top" />
                                <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="5">
                                    <TextBlock Text="Sheet 名称:" VerticalAlignment="Center" />
                                    <hc:TextBox Text="{Binding SheetName2, UpdateSourceTrigger=PropertyChanged}" Width="200" Margin="5,0" />
                                    <Button Content="预览" Command="{Binding Preview2Command}" Style="{StaticResource ButtonPrimary}" hc:IconElement.Geometry="{StaticResource App.Eye}" />
                                </StackPanel>
                            </Grid>
                        </hc:Card>
                    </Grid>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10" HorizontalAlignment="Right" IsEnabled="{Binding IsCoreFunctionalityEnabled}">
                        <Button Content="重置" Command="{Binding ResetCommand}" Height="50" Padding="20,10" Style="{StaticResource ButtonDanger}" Margin="0,0,10,0" hc:IconElement.Geometry="{StaticResource App.Refresh}" />
                        <TextBlock Text="最大查询行:" VerticalAlignment="Center" Margin="0,0,5,0" />
                        <hc:NumericUpDown Value="{Binding MaxRowCount}" Minimum="1" Maximum="100000" Margin="0,0,10,0" Width="100" />
                        <Button Content="同时预览" Command="{Binding PreviewBothCommand}" Height="50"
                            Padding="20,10" Style="{StaticResource ButtonInfo}" Margin="0,0,10,0" hc:IconElement.Geometry="{StaticResource App.EyeCheck}" />
                        <Button Content="导出到 Excel" Command="{Binding ExportCommand}" Height="50"
                            Padding="20,10" Style="{StaticResource ButtonPrimary}" Margin="0,0,10,0" hc:IconElement.Geometry="{StaticResource App.MicrosoftExcel}" />
                        <Button Content="保存为批量配置" Command="{Binding SaveConfigCommand}" Height="50"
                            Padding="20,10" Style="{StaticResource ButtonSuccess}" Margin="0,0,10,0" hc:IconElement.Geometry="{StaticResource SaveGeometry}" />
                    </StackPanel>
                </Grid>
            </TabItem>
            <TabItem Header="批量导出">
                <views:BatchExportView x:Name="BatchExportView" />
            </TabItem>
            <TabItem Header="表映射配置">
                <views:TableMappingView/>
            </TabItem>
            <TabItem Header="对比报表">
                <views:ComparisonReportView/>
            </TabItem>
        </TabControl>


        <StatusBar Grid.Row="2" VerticalAlignment="Bottom" Margin="0,5,0,0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</hc:BlurWindow>